<!-- templates/tienda/seguimiento_pedido.html -->
{% extends 'tienda/base.html' %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <a href="{% url 'tienda:index' %}" class="btn" style="margin-bottom: 2rem;">← Volver al inicio</a>
    
    <div class="card">
        <h1 style="text-align: center; margin-bottom: 1rem;"> Seguimiento de Pedido</h1>
        <p style="text-align: center; color: #666; margin-bottom: 2rem;">
            Token: <strong>{{ pedido.token_seguimiento }}</strong>
        </p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <div class="estado-pedido estado-{{ pedido.estado_pedido }}">
                <h3>Estado del Pedido</h3>
                <p style="font-size: 1.2rem; font-weight: bold;">
                    {{ pedido.get_estado_pedido_display }}
                </p>
            </div>
            
            <div class="estado-pago estado-{{ pedido.estado_pago }}">
                <h3>Estado del Pago</h3>
                <p style="font-size: 1.2rem; font-weight: bold;">
                    {{ pedido.get_estado_pago_display }}
                </p>
            </div>
        </div>
        
        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
            <h3> Información del Pedido</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                <div>
                    <p><strong>Cliente:</strong> {{ pedido.nombre_cliente }}</p>
                    <p><strong>Email:</strong> {{ pedido.email }}</p>
                    <p><strong>Teléfono:</strong> {{ pedido.telefono|default:"No especificado" }}</p>
                </div>
                <div>
                    <p><strong>Producto:</strong> {{ pedido.producto_referencia.nombre|default:"Diseño personalizado" }}</p>
                    <p><strong>Plataforma:</strong> {{ pedido.get_plataforma_display }}</p>
                    <p><strong>Fecha solicitada:</strong> {{ pedido.fecha_requerida|date:"d/m/Y"|default:"No especificada" }}</p>
                </div>
            </div>
            
            <div style="margin-top: 1rem;">
                <p><strong>Descripción del diseño:</strong></p>
                <p style="background: white; padding: 1rem; border-radius: 5px; border-left: 4px solid #667eea;">
                    {{ pedido.descripcion_diseno }}
                </p>
            </div>
        </div>
        
        <!-- ===== AGREGAR AQUÍ EL BLOQUE DEL PRESUPUESTO ===== -->
        <div style="background: linear-gradient(135deg, #e7f3ff 0%, #d4e7ff 100%); 
                    padding: 1.5rem; 
                    border-radius: 10px; 
                    margin-bottom: 2rem;
                    border-left: 5px solid #198754;">
            <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                <span style="font-size: 1.5rem;"></span> Presupuesto Estimado Automático
            </h3>
            <p style="font-size: 2rem; font-weight: bold; color: #198754; text-align: center; margin: 1rem 0;">
                ${{ pedido.presupuesto_estimado|floatformat:"0" }}
            </p>
            <div style="background: white; padding: 1rem; border-radius: 5px; margin-top: 1rem;">
                <p style="font-weight: bold; margin-bottom: 0.5rem;"> ¿Cómo se calculó?</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
                    <div>
                        <strong>Precio base:</strong><br>
                        ${{ pedido.producto_referencia.precio_base|default:"10.000"|floatformat:"0" }}
                    </div>
                    <div>
                        <strong>Complejidad:</strong><br>
                        {{ pedido.descripcion_diseno|length }} caracteres
                    </div>
                    <div>
                        <strong>Imágenes ref.:</strong><br>
                        {{ pedido.imagenes_referencia.count }} imágenes
                    </div>
                    <div>
                        <strong>Plataforma:</strong><br>
                        {{ pedido.get_plataforma_display }}
                    </div>
                </div>
                <p style="color: #666; font-size: 0.8rem; margin-top: 0.5rem; font-style: italic;">
                    * Este es un cálculo automático. El precio final puede ajustarse.
                </p>
            </div>
        </div>
        <!-- ===== FIN DEL BLOQUE DEL PRESUPUESTO ===== -->
        
        {% if imagenes_referencia %}
        <div style="margin-bottom: 2rem;">
            <h3> Imágenes de Referencia</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                {% for imagen in imagenes_referencia %}
                <div style="text-align: center;">
                    <img src="{{ imagen.imagen.url }}" 
                         alt="Referencia {{ forloop.counter }}" 
                         style="width: 100%; height: 150px; object-fit: cover; border-radius: 5px;">
                    <p style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">
                        {{ imagen.descripcion|default:"Imagen de referencia" }}
                    </p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #eee;">
            <p style="color: #666;">Si tienes preguntas sobre tu pedido, contáctanos.</p>
            <p><strong>Fecha de creación:</strong> {{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</p>
        </div>
    </div>
</div>

<style>
.estado-pedido, .estado-pago {
    padding: 1.5rem;
    border-radius: 10px;
    text-align: center;
}

.estado-solicitado { background: #fff3cd; border-left: 5px solid #ffc107; }
.estado-aprobado { background: #d1ecf1; border-left: 5px solid #0dcaf0; }
.estado-en_proceso { background: #d4edda; border-left: 5px solid #198754; }
.estado-realizado { background: #cce7ff; border-left: 5px solid #0d6efd; }
.estado-entregado { background: #e2e3e5; border-left: 5px solid #6c757d; }
.estado-finalizado { background: #d1e7dd; border-left: 5px solid #0f5132; }
.estado-cancelado { background: #f8d7da; border-left: 5px solid #dc3545; }

.estado-pendiente { background: #fff3cd; border-left: 5px solid #ffc107; }
.estado-parcial { background: #d1ecf1; border-left: 5px solid #0dcaf0; }
.estado-pagado { background: #d4edda; border-left: 5px solid #198754; }
</style>
{% endblock %}
